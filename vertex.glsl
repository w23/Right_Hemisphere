#version 120
uniform float t;
varying float	w[13]; // array with current envelopes values

int ef[]=int[219] // envelope data: key frames offsets
(
    0,239,1,28,32,180,7662,858,480, // fade
    0,180,540,1,719,1,359,5400,480,614,886, // shift11
    0,480,1,119,1140,2,126,2,2210,2,30,2,1646,1,59,900,18,12,10,12,8,420,300,2,32,20,66,1560, // zoomshift
    0,960,1,239,1,2879,1,31,1,169,1,39,1,1437,1,1439,1,1979, // steps
    0,5760,1,779,178,4,358,120,2,298,1,1037,642, // greyscale
    0,6240,2,42,196,240,14,6,202,258,1980, // greyscale2
    0,720,1,239,1,239,1,239,60,3302,1,477,1,479,1,3419, // timeshift
    0,480,1,239,1,239,1,239,1,3601,1,477,1,479,1,3419, // shiftX
    0,480,1,239,1,239,1,239,1,3601,1,477,1,3899, // shiftY
    0,480,1,239,1,59,180,1,239,1,239,1,599,2762,1,477,1,479,1,1439,1,1499,480, // zoomXY
    0,1740,128,2,172,2,6,8,42,180,1800,2,32,2,54,632,1,597,2,14,104,1980,2,118,1560, // red
    0,1680,1,11,30,18,1,2543,36,2,4858, // skip
    0,1488,372,18,1242,2,24,2,30,24,878,2,32,2,72,72,2,20,2,36,2,4,26,4828 // distort
);

float ev[]=float[219] // envelope data: nodes values
(
    0.,.3,.6,.47,.53,1.,1.,0.,0., // fade
    300.,300.,228.9,263.,243.,134.,86.77,165.23,160.,148.53867,133., // shift11
    2.8,2.8,2.7,2.8,2.8,2.6,2.5,2.8,2.8,3.,3.,2.8,2.8,7.298,7.246,3.,5.79,5.545,5.67,5.57,5.595,4.,4.,3.6,3.95,3.9,4.,4., // zoomshift
    3.,3.,4.,4.,3.,3.,2.,2.,3.,3.,2.,2.,3.,3.,1.,1.,2.,2., // steps
    0.,0.,1.,1.,.9,1.,1.,.86,.5,.3,0.,0.,.7, // greyscale
    0.,0.,.85,.43,.23,.21,.4,1.,1.,.5,.5, // greyscale2
    86.,86.,164.,164.,-211.,-221.,164.,164.,6.,6.,156.,150.,122.,118.,6.,6., // timeshift
    -.5,-.5,-.062,-.062,-.37,-.37,-.98,-.98,-.5,-.5,.2,0.,-.45,-.45,-.5,-.5, // shiftX
    -.5,-.5,-.8,-.8,-.5,-.5,.28,.28,-.5,-.5,-.4,-.4,-.5,-.5, // shiftY
    1.4,1.4,1.04,1.04,1.2,1.2,1.12,.48,.5,.86,.85,1.2,1.2,2.38,.7,.7,1.3,1.15,1.4,1.4,1.65,2.2,1.94, // zoomXY
    0.,0.,1.,0.,0.,.4,.4,.2,0.,0.,.7,.26,.6,.34,.75,1.,0.,0.,.25,.23,0.,0.,.6,0.,0., // red
    15.,15.,14.,14.,0.,0.,15.,15.,0.,15.,15., // skip
    0.,0.,.4,0.,0.,.35,.1,.2,.05,0.,0.,.25,.1,.2,0.,0.,.3,.1,.3,1.,.9,.2,0.,0. // distort
);

void main() {
	for (int i=0, j=1, f; i<13; i++) // fill parameter[] with current envelopes values
	{
		for (f=0; j<220; j++)
		{
				f += ef[j]; // sum offsets
				if(f >= int(t*60.)) break; // ?
		}
		w[i] = mix(ev[j-1], ev[j], (t*60. - float(f-ef[j])) / float(ef[j]) );
		for (; j<220; j++) if(ef[j]==0) break; // ?
	}
	gl_Position = gl_Vertex;
}
